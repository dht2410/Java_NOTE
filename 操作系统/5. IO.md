## IO

### 1. IO设备

IO设备分为块设备和字符设备。块设备传输以一个或多个连续的块为单位，可寻址；字符设备传输以字符为单位，不可寻址。

IO设备有设备控制器。**设备控制器包含寄存器和数据缓冲区。**寄存器用来和CPU通信，数据缓冲区用于组装流式数据成块。

寻址分为两种，单独编址的和内存映射IO。

中断：

- 所有设备都和主板上的中断控制器相连。
- IO设备准备就绪或完成任务时，产生一个中断给中断控制器。
- 中断控制器置起一个中断CPU信号，并告诉CPU中断号码，以去寻找中断向量。

### 2. IO软件

需要满足设备独立性，即同一个程序能够应用在不同的设备上。

于此相关的是**统一命名**的目标。文件或设备的命名应该是一串字符串而和设备无关。因此有了**挂载**。

中断驱动IO：当打印字符串的系统调用被发出时，字符串缓冲区被复制到内核空间。然后一个一个字符往打印机复制。中间CPU运行其他程序。当打印机打印完时，发出中断。

IO软件的层次（从上到下）：

- 用户级IO软件
- 与设备无关的操作系统软件
- 设备驱动程序（每个连接到计算机的IO设备都需要驱动程序进行控制，驱动程序来和设备控制器交互）
- 中断处理程序
- 硬件

缓冲：为了避免字符一个一个地往外送降低效率，会增加一个缓冲区。例如发送网络数据，用户进程的数据先复制到操作系统内核，操作系统内核再复制到网络控制器中，发出，接收的网络控制器先缓存，然后放到操作系统内核，最后给到用户进程。

